---
title: 解决了在Github Action自动化部署的环境下，需要修改node_modules的问题
date: 2023-09-19 10:00:00
tags: Blog
---

> 前情提要：我用Github Action配置了自动化部署后，再次上传博文时发现Letax渲染出现了问题。想来想去，突然想到，之前修改过Kramed渲染引擎的escape和em。下述我解决问题的思路。

## 发现问题

首先是本地渲染并没有问题，随后想到Github Action会在云上重新`npm install`，这样我本地的node_modules的修改并没有上传，百度搜索到的办法有两种：重新上传一个你自己的npm或者patch-package，考虑到复杂性，我选择第二种办法。

## `npm install`流程

此处参考了这个兄弟的博客（[CSDN](https://blog.csdn.net/yjitcsdn/article/details/100156695)）。

流程图如下：

![流程图](https://mermaid.ink/svg/pako:eNqNVW9P00Ac_irNGZOSDOLarYO-8IVRE6NGg_pGZ8ytd2PVrm3aLjoJCVOBzI0NJE5FEVFw8w-oQeMIAt_F7LruW3jbjdKBKJdlubvn-d3z_O531xsFioEwkEFSM-4qKWg53NVTXFznaDt-nLMziRELminu6qXLcX1v2slqmFORwCVVTZOPJRLJkO1Yxh0sH0tKUrfff1dFTkoWzHshxdAMi2LJXV4_gjZVs2BW5qJc9KBg8_PnRn3cXV3xoXZDqoUVRzV07sJwDwDDvJuvektF3Uz3cf39Jzko8DfIy23ysOxVJ71qvjU17b3PuePVm31-JNYR6wfDyc-VZq1A1uYbG_nm_CPTwqpuO1DTWk8-kNWZbrRvlEbc6hIY8nef7ZagKosr3pe3rfcV8u1BY3vB-1FhbhNCFzKhcgeO4IHbtqH3BUIFRhN5t7ZEFp65-RzZWCfFSjyu_56co_-ktNl6sUyzJMvTjONDXuknKVfIxC-ytrEf2nnRqH_0dqbaKZc_kdw8wihj4qC0SKXJ6nPyqtaxEOEb9QKrzX5Woz4dIEZ5MjNr4RGVljzLsmPqpFRo_vpAihPNrVmyMO6boet6W1t73qrvKNObWtfpEb2VNlBGw3ZX0q-cX4fu0rM199Xi_wqhhPm9srICKAK_Ow7w2K4rYptuQgsfqt49NEdSR2G-RxoJvGnYzkF5xOQRk88kNNVOBWGRwZHD3MFwh3DghAYmOoSDWxec6VB68wtenf0Xl8yUSPlrc32zubnYw6A_t_KVvH09fPbcaaZbqrXGc-TpJJnLNXaW3NyXnoBetvvyO51oj8iTIou5cv4avaAXoWmq-giZWKeivQscKSRghQXQDCjnUFuHZu7mC24x561tk-WpXh_5Anlc87bnyMSKu7DUfJNjmn5--9if3HL5CLx_WmaRHTDoq1F_fOTc6AffASGQxlYaqoi-EaNtLA6cFE7jOJBpF-EkzGhOHMT1MUqFGce4ktUVIDtWBodAxkTQwadVSDcoDeQk1Gx_9gxSHcPaZZpQv24Y6cAQyKPgHpBjsYGoJAiSGBkcjElDUTEEskAWpQEhFhEjQ0JYkCJSZDAyFgL3OwucGIgJUkyKitETg7HwUCw6FAK4o3WRvXSdB2_sD4P12Z4)

更多的npm script生命周期可以参考：[简书](https://www.jianshu.com/p/0b35eaa4f1b9)

## `patch-package`插件

`patch-package`这个插件只支持`npm`和`yarn`某一种，因此项目文件夹下只能有`package-lock.json`或者`yarn.lock`其中一种。

- 安装插件并生成修改补丁，在命令行输入：

```sh
npm install patch-package
npx patch-package `你要修改的包名`
```

- 修改`package.json`，在script下增加如下内容

```json
{
  "scripts": {
    "postinstall": "patch-package"
  }
}
```

完成上述配置，便可以在`npm install`的`postinstall`周期对新下载的node_modules打上我们自己修改的补丁。

至此解决了在Github Action自动化部署的环境下，解决需要修改node_modules的问题。
